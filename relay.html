<html>
	<head>
		<title>Sync example</title>
	</head>
	<body>
		<h1>Sync message exchange example</h1>
		<h2><a href="https://httprelay.io/" target="_blank">HTTP Relay</a> sync communication method</h2>
		<p>
			A and B HTTP clients (web browser to web browser) synchronously exchanging messages using HTTP <strong>GET method</strong> and URL query parameters.
			Query parameters are received by the other side in the response "Httprelay-Query" header field value.
		</p>

		<fieldset>
			<legend>A HTTP Client</legend>
			GET https://demo.httprelay.io/sync/<input class="chan" size="6" />?<input class="msg" placeholder="msg=mymessage" size="12" /><button>Exchange with B</button id="btnA"><br />
			<p>Response "Httprelay-Query" header field value:</p>
			<p></p>
		</fieldset>

		<br />

		<fieldset>
			<legend>B HTTP Client</legend>
			GET https://demo.httprelay.io/sync/<input class="chan" size="6" />?<input class="msg" placeholder="msg=mymessage" size="12" /><button id="btnB">Exchange with A</button><br />
			<p>Response "Httprelay-Query" header field value:</p>
			<p></p>
		</fieldset>
		<script>
			// Send message
$('button').click(function(e) {
  let chan = $(e.currentTarget).siblings('.chan').val();
  let elMsg = $(e.currentTarget).siblings('.msg');
  let elPanel = $(e.currentTarget).parent();
	elPanel.attr('disabled', '');
  $('.chan').attr('disabled', '');
  
  $.get('https://demo.httprelay.io/sync/' + chan + '?' + elMsg.val())
  	.done(function(data, textStatus, request) {
      elPanel.append(request.getResponseHeader('Httprelay-Query') + '<br>');
  	})
  	.always(function() {
  		elPanel.removeAttr('disabled');
		  $('.chan').removeAttr('disabled');
		  elMsg.val(null);
  	});
})

var linkUrl;
$('.chan').on('paste keyup', function(e) {
	$('.chan').val($(e.currentTarget).val());
})

// Generating random channel id
$('.chan').val(Math.random().toString(36).substr(4)).trigger('change')
		</script>
	</body>
</html>
